
# Introduction

Distributed Energy Resources(DERs)
Electricity trading has changed in recent years with the advent of smart grid technologies. The increased availability of distributed generation with intelligent infrastructure has enabled residential consumers to harness energy and inject it into the distribution system. The consumers are now able to trade energy with each other and the grid. The new grid participants provides more decentralization to the smart grid. (Doan, 2021) The continuous integration of DERs, rooftop solar, energy storage, control devices and the advances in Information and Communication Technology (ICT) devices are transforming electricity consumers into prosumers.(Khalili, 2020)

# Peer-to-Peer (P2P) Networks 

With the increasing connection of renewable energy sources, traditional energy consumers are becoming prosumers, who can both consume and generate energy (Luo Y,2014). The trends are extensive growth in small-scale distributed energy resources, which encompass behind-the-meter generation, energy storage, inverters, electric vehicles, and control loads (Tushar,2020). The smart grid must grow to incorporate the bi-directional flow of electricity between supply and demand sources as penetration of Plug-in Electric Vehicles (PEVs) and distributed energy resources (DERs) like Photo-voltaic Solar Panels, (PV) increases in residential sectors. Peer-to-Peer (P2P) energy trading has emerged as a next-generation energy management mechanism for the smart grid that enables each prosumer of the network to participate in energy trading with other prosumers and the grid (Tushar,2018).  

Renewable energy sources are usually intermittent and difficult to predict. When prosumers have surplus electricity, they can curtail it, store it with energy storage devices, export it back to the power grid, or sell it to other energy consumers. The direct energy trading among consumers and prosumers is called peer-to-peer energy trading, which was developed based on the “P2P economy” concept (also known as sharing economy) (Juho,2018) and is usually implemented within a local electricity distribution system.

With the prosumers in control of setting the terms of transactions and the delivering of goods and services (Morstyn,2018), prosumers can gain more through trading with each other and the grid. (Tushar, 2019)The challenge is that in a P2P network there isn’t a central authority that dictates the terms and settlement of transactions. A trustless system must be created that can simulate the needs and coordinate between competing agendas to reach a consensus for each participant while staying within the constraints of the physical systems. 
This paper aims to provide an overview of innovations around P2P energy trading networks:

## Elements of P2P Networks
The P2P energy trading markets have a virtual, and physical layer. The virtual layer essentially provides a secured connection for participants to decide on their energy trading parameters. It ensures that all participants have equal access to a virtual platform. The virtual platform facilitates the transfer of buy and sell orders, and financial transactions. The physical layer is a physical network that facilitates the transfer of electricity from sellers to buyers once the financial settlements between both parties are completed over the virtual layer platform. It can be a traditional distributed-grid network maintained by the independent system operator or an additional separate physical microgrid distribution grid, in conjunction with the traditional grid.(Juho,2018)

1) *Virtual layer*: The virtual layer is a secure connection between the participants. It ensures that all participants have equal access to a virtual platform. The virtual platform facilitates the transfer of buy and sell orders, and financial transactions.

2) *Physical layer*: The physical layer is a physical network that facilitates the transfer of electricity from sellers to buyers once the financial settlements between both parties are completed over the virtual layer platform. It can be a traditional distributed-grid network maintained by the independent system operator or an additional separate physical microgrid distribution grid, in conjunction with the traditional grid.

## Premises leading towards P2P Markets
The advent of microgrid technology and the economic biliateral contracts has enabled the emergence of P2P markets in the energy sector. Bilateral contracts aim to increase competition in electricity markets. (Bower, 2000) It is an agreement between two parties to exchange electric energy. It is a credible alternative to the pool structure used in the wholesale electricity market. Microgrids are known as low voltage grids, which are used to supply electricity to communities that can be operated in an islanding and grid connected mode. Microgrids can have DERs and gain an advantage to continuing to operate in the islanding and grid connected mode. (Tushar, 2019). The DERs are managed by Prosumers in a microgrid and can sell energy back to the grid with a benefit from the Grid. 


## Ongoing P2P Market Initiatives

| P2P trading Platform | Country | Details
|-|-|-|
Brooklyn Microgrid | United States | Brooklyn Microgrid is a community energy market on a microgrid. Members can buy and sell energy from each other with smart contracts based on blockchain. (Mengelkamp et al., 2018) An 'Exergy token' called 'XRG' has been developed as an additional project by LO3 to promote commercial investments in the community energy market. (Sakineh, 2020)
Centrica plc | United Kingdom | Centrica is a pilot project to develop a local energy market in Cornwall, UK by testing the use of flexible demand, generation, and storage, and rewarding consumers for being more flexible with their energy. Centrica is trialing the use of blockchain for this platform, using LO3's blockchain-powered energy trading platform (Centrica, 2018)
Lumenaza | Germany | Lumenaza's "utility-in-a-box" energy platform enables P2P energy sharing and communities on a local, regional, and national level. The software connects producers of electricity with consumers, controls demand and supply, and includes balance group management, aggregation, billing, and visualization of energy flows. It allows energy communities to participate in electricity market design (Lumenaza, 2020). 
Piclo | United Kingdom | Piclo by open utility (a platform) and Good Energy ( a renewable energy power company) matches consumers and prosumers based on their preferences and locality every 30 minutes. Consumers are provided with consumption data visualizations, and generators are provided with control and visibility over who buys power from them. Good Energy balances the peaks and valleys in generation, provides contracts and meter data and does the billing (Piclo, 2019).
SOLshare | Bangladesh | SOLshare installs small-scale mini-grids that connect local consumers and allow them to share electricity within the locality. Consumers who have solar panels installed on their homes can supply surplus power to others who do not have access to electricity. (UNFCC,2020)
sonnenCommunity | Germany | sonnenCommunity allows sharing of self-produced renewable power by individual consumers who are using sonnens batteries. This surplus energy is not fed into the grid, but into a virtual energy pool that supplies energy to other community members during times when they cannot produce. The price is fixed at USD 25 cents/kwh. The monthly usage fee for the platform is EUR 20 (sonnen, 2019).
Transactive Energy Initiative | Colombia | The pilot project activities include the development of a P2P trading app, the elaboration of policy recommendations for Colombian policymakers, and a roadmap for commercial scale-up (UCL, 2019).
Vendebron | Netherlands | Allows consumers to buy power directly from prosumers, at the price set by the prosumers. It behaves as an energy supplier that connects consumers. Provides suppliers with generation forecasting information for their assets. The monthly usage fee of the platform is USD 12 (Vanderbron, 2020)
P2P-SmartTest | Europe (Finland, United Kingdom, Spain, Belgium) | Advanced control and ICT for P2P energy market, local control and ICT market design 
EMPOWER | United States | Architecture and ICT solutions for provider in local market , Local control and ICT. (EMPOWER, 2015)
NRGCoin | Europe (Belgium, Spain) | 2015 | Distribution grid level architecture and ICT solutions for provider in local market , Local control and ICT. (NRGCoin, 2013)
Enerchain | Europe | Enerchain is a decentralized energy market on a microgrid. Members can buy and sell energy from each other with smart contracts based on blockchain. (Mengelkamp et al., 2018)
Enerchain | Europe | P2P wholesale trading platform. (Enerchain, 2017)
Community First! Village | Unite States | Build Self-sustained community for homeless, local control and ICT. 
PeerEnergy Cloud | Germany | Cloud-based energy trading for excessive production 
Smart Watts | Germany | ICT to control consumption in a secure manner 
NOBEL | Europe | ICT for energy brockerage system with consumers , local control and ICT. 
Energy Collective | Denmark | Deployment of local P2P markets in Denmark
P2P3M | Europe (United Kingdom), Asia (South Korea) | Prototype P2P energy trading/sharing platform, market design


## P2P Energy Trading System

1) *Prosumers*: The end-user who acts as a buyer or a seller in P2P energy trading. Each prosumer chooses a role according to their current energy consumption and generation. The prosumer can be a consumer or a producer.
2) *System Operator*: The system operator is the central authority of the P2P energy trading system. The system operator is responsible for the entire energy trading service. The operator can log in via the web portal and manage the overall system.
3) *Smart Controller*: The component that allows for exchange of information in the market. Each prosumer has its own smart controller, so that it can exchange information with others in the P2P energy trading market.


# Market Structure
Market operations of a P2P network consists of payment rules, and a clearly defined bidding format. The main objective is to enable an efficient energy trading process by matching the sell and buy orders in near real-time granularity. In market operations the generation of each producer influences the thresholds of maximum and minimum energy allocation. Different market-time horizons may exist in the market operation that should be able to produce enough allocation at every stage of operation. (Tushar, 2020) 

- *Full P2P* : Fully decentralized markets allow for prosumers to independently and directly negotiate with each other to decide on energy trading parameters without any centralized supervision by leveraging bilateral contracts between prosumers. In a fully decentralized market the bilateral contracts capture both the upstream-downstream energy balance as well as forward market uncertainty. (Morstyn,2019) 

- *Community-based*: Community-based market can be applied to community microgrids and group of neighboring prosumers. The members of the community share common interests and goals even though they are not at the same location. (J. Ni ,2016) may work either in a collaborative or competitive manner. (Tushar, 2016) Participants generally trade energy through a community manager. The community manager manages exchanges outside of the community. Privacy is preserved by the community manager. (J. Ni ,2016) 

- *Hybrid P2P*: Composite market combines the fully decentralized and community-based market designs. An individual prosumer can engage in P2P trading between each other, while also interacting with existing markets like fully distributed markets. (N. Liu,2018) Community manager can also oversee trading inside the community. (Park, 2018)

|Market Structure | Advantages | Challenges | References
|-|-|-|-|
| *Full P2P* | 1) Freedom of choic and autonomy, 2) Energy use aligns with preferences , 3) Complete "democratization" | 1) Investment and maitenance with ICT infrastructure, 2) Potentially slow convergence, 3) Predicting system behaviour, 4) Gurantee of safety |  |
| *Community-based* | 1) Enhancing comunity relationship , 2) Mobilizing social cooperation, 3) New services for grid operates |1) Reaching the preferences for all member all the time, 2) Aggregating all members data 3) Unbiased sharing | |
| *Hybrid P2P* | 1) ICT infrastructure and computation effort are scalable to all system, 2) Co-existant design, 3) More predictable to grid operators | 1) Coordinating internal trades in the communities with trades between high level agents. | Prosumers can directly negotiate with each other to decide on energy trading parameters without any centralized supervision by leveraging bilateral contracts between prosumers. In a fully decentralized market the bilateral contracts capture both the upstream-downstream energy balance as well as forward market uncertainty. (Morstyn,2019) |


# Game-theory for P2P trading

## Using Game-Theory in P2P

Game and auction-theoretic models have been used in P2P energy trading as an effective means of energy management approaches. The development of P2P energy trading has the potential to substantially benefit prosumers in terms of earning revenues, reducing electricity costs, and lowering their dependency on the grid. (Khalili,2017) The system poses the challenge of modeling the decision-making process of each participant for the greater benefit of the entire energy network while considering human factors, e.g., rationality, motivation, and environmental friendliness. Particularly, in settings where there are many users with conflicting interests participating, it would be challenging either to integrate such conflicting interests when designing the decision-making process of each participant or, if necessary, to motivate the users to cooperate with reducing costs, maximizing revenues, and pursuing renewable energy objectives. (Farrel ,2018)

An energy management solution is needed that provides efficient and robust operation considering the conflicting nature of energy trading. Game theory should be a very effective tool for modeling the decision-making process of participants.

## Basic Game-Theoretic Concepts
Game theory is a mathematical and signal processing tool that analyzes Custom Papers/References > Economics of electric vehicle charging A game theoretic approach strategies in competitive solutions where the outcome of a participants choice is based on the actions of other participants. There are two main branches: 1. noncooperative and 2. cooperative game theory.

### Non-Cooperative games
These types of games allow players to take necessary action, to make optimal decisions, without any coordination or communication with each other. Noncooperative games can be further divided into 'static' or 'dynamic' games.

• *Static game* : Players act only once, either simultaneously or at different times. An example could be two business owners deciding where to open a new store location.

• *Dynamic game*: Players act more than once and have input regarding the choices of other players. Time can play a central role in these games. Dynamic games can be modeled as a series of static games, but time and information would need to be reflected in the utility functions. An example of a dynamic game would be Chess.

For both types of non-cooperative games, the players will make decisions based on "pure strategy" a deterministic way, or a probabilistic way "mixed strategy".(Juho, 2018) The most popular concept in non-cooperative games is the solution concept called the Nash equilibrium. It refers to a stable state of a non-cooperative game where neither player can improve its utility by unilaterally altering its action when other players actions are fixed. An example in the game of Monopoly is when there are no more actions the player can make with the money on hand that could better the situation. A Nash equilibrium always exists in a game with mixed strategies (probabilistic decisions) but not always guaranteed in pure strategies (deterministic). Finally the non-cooperative game may have multiple Nash equilibriums and the most desirable one should be chosen for the solution. (Xie, 2016)

## Game-Theoretic Applications for P2P

The application of game theory in energy trading and management is extensive. However, the discussion of its application in the field of P2P energy trading is limited, which could be because of the relatively recent emergence and exploration of P2P trading frameworks in energy domains (Juho ,2017).

## Coalitional Energy Trading
If small scale electricity suppliers and consumers are participants on the network and are connected on the physical layer through local distribution that can be islanded off, then there is potential for trading energy in an isolated fashion. The discrepancy between the wholesale price and retail price matters because the peer-to-peer trading price will be greater than the wholesale price but less than the retail price. The consumers will always want to trade with a peer because it would be cheaper than retail energy traveling over long transmission lines. The local prosumers would also benefit from the trading price being more than the wholesale price of creating the electricity and therefore gaining profit. (Lee, 2014)

The coalition formed between prosumers is a canonical coalitional game with transferable utility, and the price for P2P energy trading is determined by an asymptomatic Shapley value (Han, 2009). The net surplus of the coalition is sold to the retail market at wholesale prices but bought at retail prices if there is a net deficiency. The coalition can then effectively ban together to optimize the return on energy generated and consumed by trading with each other before selling or purchasing from the grid.
There are only 10 states that still pay the wholesale price (avoided cost) when selling back to the grid. All other states pay retail price to sell to the grid. In these states the super additivity of the grand coalition is no longer viable and there is no reason to stay in the coalition. Custom Papers/References > Net Metering is a Win-Win for Utilities and Local Communities An avoided cost (also known as net-metering) is the minimum amount an electric utility is required to pay an independent power producer, under the PURPA regulations of 1978, equal to the costs the utility calculates it avoids in not having to produce that power (usually substantially less than the retail price charged by the utility for power it sells to customers).

### Day-Ahead Optimization
With a view toward reducing the cost of energy trading within the grid, a day-ahead optimization process regulated by an independent central unit has been proposed in Custom Papers/References > Demand-side management via distributed energy generation and storage optimization. The existence of optimal strategies is proven, and, furthermore, the authors present a distributed algorithm to be run on the users’ smart meters, which provides optimal energy-production and storage strategies while preserving user privacy and minimizing required central unit communication.

### Auction Games for DERs
Auction games have been proposed for trading both storage space and renewable energy from DERs (Tushar, 2016) The real-time implementation of a multiagent-based game-theoretic reverse auction model for microgrid market operations featuring conventional and renewable DERs is discussed. Custom Papers/References > Real-time implementation of multiagent-based game theory reverse auction model for microgrid market operation The proposed methodology was realistically implemented in a smart grid system at Florida International University, and the subsequent investigation shows that the proposed algorithm and the industrial hardware-based infrastructure are suitable for implementation in the existing electric utility grid.
Meanwhile, the authors in (Tushar, 2016) utilize an auction game to study the solution of joint-energy-storage ownership sharing between multiple shared facility controllers (SFCs) and those dwelling in a residential community. The auction process possesses both incentive-compatibility and individual-rationality properties and is also capable of enabling the residential units (RUs) to decide the fraction of their shared energy storage capacity with the SFCs of the community to assist in storing electricity
For example, in (Tushar, 2016) analysis a coalitional game is used to study the cooperation between small-scale DERs and energy users to enable the direct trading of energy without going through retailers. The asymptotic Shapley value is the core of the coalitional game so that no small-scale DERs or energy users have an incentive to abandon the coalition, which suggests the stable direct trading of energy for the proposed pricing scheme. Furthermore, numerous case studies demonstrate that the scheme is suitable for practical implementation. The authors in (Saad,2009) focus on comprehensive economic power transactions of multiple microgrid networks with multiple agents; they design a three-stage algorithm based on a coalitional game strategy and include request, exchange, merge-and-split, and cooperative transaction stages. The developed algorithm enables microgrids to form coalitions where each microgrid can exchange power directly by paying a transmission fee.

### Double Auction-Based Game Theoretic Mechanism for P2P Energy Trading
Prosumers determine their role based on their energy generation and demand. Then, prosumers register in the P2P market by submiting their bid/ask and amount of energy to the auctioneer. We note that the submitted value is always positive in terms of quantity. A double auction market is when a buyer's price and a seller's asking price match, and the trade proceeds at that price. Auction markets do not involve direct negotiations between individual buyers and sellers, while negotiations occur for over the counter trades.

The traditional Vickry auction scheme is a sealed bid auction. Bidders submit their reservation prices to the auctioneer without knowing other prospective bidders' prices. The bidder with the highest reservation price is the winner but pays at the second-highest price.

1) *Auctioneer*: The coordinator, which determines the rules to reflect the number of buyers and sellers who engage in trade. It sends buyers the price during the auction process according to maximum and minimum price. Finally, it determines the precise quantity and price based on pre-defined rules. 

2) *Buyers*: The buyers submit their bid/ask price and amount of energy to the auctioneer. They have deficit demand and engage in the market to buy electricity. They expect their profit in the market to be optimized.

3) *Sellers*: The sellers submit their bid/ask price and amount of energy to the auctioneer. They have surplus demand and engage in the market to sell electricity. They provide extra energy at particular time of day and expect benefit from selling to the market instead of selling it to the main grid. 

# Blockchain for P2P

When communicating between many participants an encrypted form of communication can be used to secure transactions between the participants. They all work towards processing the message and providing a consensus on what the message between any two participants should be. This consensus across all participants is crucial for trustless systems. In P2P networks a blockchain messaging mechanism can be used to validate financial transactions on a distributed ledger, it can also be used to track energy usage without the fear of tampering with the metering information over the air. The attack would need to achieve 51% control of the network in order to approve the false transactions. In an unsecure network the attack would only need to override a single node and create false readings for a meter or a financial transaction. In a federated system the operator would oversee securing the infrastructure and communications. But in an open P2P network design cryptographic methods such as blockchain provide unfederated security, privacy and protection against the network.
